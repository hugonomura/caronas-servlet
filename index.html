<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen"/>
  <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>

  <title>Tutorial Ajax + Servlet Java</title>
  <meta name="description" content="">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">Tutorial Ajax + Servlet Java</h1>
    </header>
    <div id="container">
      <p class="tagline"></p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/hugonomura/caronas-servlet/tarball/master" class="download-button tar"><span>Download</span></a>
          <a href="https://github.com/hugonomura/caronas-servlet/zipball/master" class="download-button zip"><span>Download</span></a>
          <a href="https://github.com/hugonomura/caronas-servlet" class="code">View Tutorial Ajax + Servlet Java on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <h1>Referências</h1>

<ul>
<li><a href="http://api.jquery.com/jQuery.ajax/">http://api.jquery.com/jQuery.ajax/</a></li>
<li><a href="http://api.jquery.com/change/">http://api.jquery.com/change/</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/DOM/Mozilla_event_reference/change">https://developer.mozilla.org/en-US/docs/DOM/Mozilla_event_reference/change</a></li>
</ul><h2></h2>

<h1>Ajax</h1>

<p>Para usar Ajax em nossa aplicação, podemos começar tanto do lado servidor, quanto do lado cliente.<br>
Nesse tutorial, optei por começar pelo lado servidor.  </p>

<h2></h2>

<h1>O servlet</h1>

<p>Novamente, não é via de regra, mas para esse caso, irei criar um novo <em>Servlet</em> para tratar a requisição feita pelo cliente.<br>
Para isso, basta clicar na raiz do <strong>projeto</strong>, <strong>novo</strong>, <strong>servlet</strong><br>
Chamaremos o <strong>Servlet</strong> de <strong>BuscaCidade</strong> e colocaremos ele no <strong>pacote</strong> chamado <strong>controle</strong>.
<a href="#"><img src="https://raw.github.com/hugonomura/imagens-tutorial/master/img17.png"></a>  </p>

<p>Clique em <code>Próximo</code>.<br>
Deixa selecionado a caixa <code>Adicionar informações ao descritor de implantação (web.xml)</code>.<br><a href="#"><img src="https://raw.github.com/hugonomura/imagens-tutorial/master/img18.png"></a>  </p>

<p>Clique em <code>Finalizar</code>.<br>
Agora vamos editar o método <strong>doGet</strong>, pois para usarmos o Ajax, iremos usar o método <strong>GET</strong>.<br>
Podemos retirar a linha que está lá.<br><a href="#"><img src="https://raw.github.com/hugonomura/imagens-tutorial/master/img19.png"></a>  </p>

<p>Para realizarmos o processamento, devemos primeiro recuperar o dado sobre o estado que foi recebido, através do método <code>getParameter</code> pertencente a <strong>request</strong>.<br>
Como o parâmetro passado pela página sera <code>uf</code>, vamos recuperá usando a seguinte linha:  </p>

<pre><code>String estado = request.getParameter("uf");
</code></pre>

<p>Agora, nosso retorno será uma <strong>string</strong> também. Vamos inicializar ela com a string vazia.  </p>

<pre><code>String cidades = "";
</code></pre>

<p>Como iremos retornar a lista já para o usuário, em formato <strong>html</strong>, é legal falarmos qual será o charset do retorno.<br>
Para isso, basta usar o método <code>setCharacterEncoding</code>.  </p>

<pre><code>response.setCharacterEncoding("UTF-8");
</code></pre>

<p>Com o parâmetro já recebido e a nossa <strong>string</strong> de retorno já inicializada, temos que fazer o devido processamento agora, fazendo com o que o retorno sejam as cidades associadas ao estado.  </p>

<pre><code>if(estado.equals("SP")){
  cidades += "&lt;option value=\"São Paulo\"&gt;São Paulo&lt;/option&gt;";
  cidades += "&lt;option value=\"São Roque\"&gt;São Roque&lt;/option&gt;";
  cidades += "&lt;option value=\"Sorocaba\"&gt;Sorocaba&lt;/option&gt;";
}
if(estado.equals("RJ")){
  cidades += "&lt;option value=\"Angra dos reis\"&gt;Angra dos Reis&lt;/option&gt;";
  cidades += "&lt;option value=\"Parati\"&gt;Parati&lt;/option&gt;";
  cidades += "&lt;option value=\"Rio de Janeiro\"&gt;Rio de Janeiro&lt;/option&gt;";
}
if(estado.equals("SC")){
  cidades += "&lt;option value=\"Bandeirante\"&gt;Bandeirante&lt;/option&gt;";
  cidades += "&lt;option value=\"Florianópolis\"&gt;Florianópolis&lt;/option&gt;";
  cidades += "&lt;option value=\"Princesa\"&gt;Princesa&lt;/option&gt;";
}
</code></pre>

<p>Com tudo já feito, devemos retornar a <strong>string</strong> para o cliente, como já faríamos para qualquer outro <strong>servlet</strong>.  </p>

<pre><code>PrintWriter writer = response.getWriter();
writer.print(cidades);
writer.close();
</code></pre>

<p>Feito isso, nosso <strong>servlet</strong> deverá ficar da seguinte forma:  </p>

<pre><code>String estado = request.getParameter("uf");
String cidades = "";
response.setCharacterEncoding("UTF-8");
if(estado.equals("SP")){
  cidades += "&lt;option value=\"São Paulo\"&gt;São Paulo&lt;/option&gt;";
  cidades += "&lt;option value=\"São Roque\"&gt;São Roque&lt;/option&gt;";
  cidades += "&lt;option value=\"Sorocaba\"&gt;Sorocaba&lt;/option&gt;";
}
if(estado.equals("RJ")){
  cidades += "&lt;option value=\"Angra dos reis\"&gt;Angra dos Reis&lt;/option&gt;";
  cidades += "&lt;option value=\"Parati\"&gt;Parati&lt;/option&gt;";
  cidades += "&lt;option value=\"Rio de Janeiro\"&gt;Rio de Janeiro&lt;/option&gt;";
}
if(estado.equals("SC")){
  cidades += "&lt;option value=\"Bandeirante\"&gt;Bandeirante&lt;/option&gt;";
  cidades += "&lt;option value=\"Florianópolis\"&gt;Florianópolis&lt;/option&gt;";
  cidades += "&lt;option value=\"Princesa\"&gt;Princesa&lt;/option&gt;";
}
PrintWriter writer = response.getWriter();
writer.print(cidades);
writer.close();
</code></pre>

<h1>O cliente</h1>

<h2></h2>

<p>Com nosso servidor já feito, agora nos resta fazer nosso cliente.<br>
Certifique-se dos <strong>ids</strong> do campo <code>Estado</code> e <code>Cidade</code>, pois recuperaremos eles através do jQuery.<br>
No meu caso, o campo <code>Estado</code> está da seguinte forma:  </p>

<pre><code>        &lt;select name="estado" id="estado"&gt;
            &lt;option value="" selected&gt;&lt;/option&gt;
            &lt;option value="RJ"&gt;RJ&lt;/option&gt;
            &lt;option value="SP"&gt;SP&lt;/option&gt;
            &lt;option value="SC"&gt;SC&lt;/option&gt;
        &lt;/select&gt;
</code></pre>

<p>E o campo <code>Cidade</code> está da seguinte forma:  </p>

<pre><code>        &lt;select name="cidade" id="cidade"&gt;
        &lt;/select&gt;
</code></pre>

<p>Note que o campo o <code>Estado</code> possui uma opção vazia, apenas para que nenhum estado esteja pré-selecionado quando o usuário desejar se cadastrar, enquanto o campo <code>Cidade</code> não possui nenhuma opção, pois o servidor irá retornar as opções de acordo com o <code>Estado</code> que estiver selecionado.  </p>

<p>Com isso certificado, basta alterar o nosso <strong>script</strong>.<br>
Após o seu <strong>footer</strong>, existe a tag <strong>script</strong> e dentro dela há:  </p>

<pre><code>  $(document).ready(function(){
          // alguns métodos de validação do form
  }
</code></pre>

<p>Ao final dos métodos de validação, mas ainda dentro do <code>$(document).ready</code>, devem estar as chamadas do nosso Ajax, que deverá ser chamado sempre que o valor do campo <code>Estado</code> for alterado. Para isso, devemos chamar nosso <strong>Ajax</strong> o valor do campo <code>Estado</code> for alterado, através do método <code>change</code>.  </p>

<pre><code>    $('#estado').change(function(){
        // ajax
    }
</code></pre>

<p>Para usarmos Ajax no cliente, devemos lembrar sempre de:  </p>

<ol>
<li>Qual método de envio das informações iremos usar?</li>
<li>Qual o caminho para o nosso Servlet?</li>
<li>Qual o formato dos dados iremos receber?</li>
<li>Quais dados serão enviados?</li>
<li>O quer fazer após o Servlet retornar as informações?</li>
</ol><p>No nosso caso:  </p>

<ol>
<li>Como alteramos o método <code>doGet</code> no <strong>Servlet</strong>, devemos enviar usando <strong>GET</strong>.</li>
<li>Como adicionamos no nosso arquivo <code>web.xml</code>, o caminho é, simplesmente, <code>BuscaCidade</code>.</li>
<li>Os dados que o <strong>Servlet</strong> retorna são <code>HTMl</code>.</li>
<li>O dado que será enviado é o valor do campo estado, sendo que o nome do parâmetro deve ser <code>uf</code>, como é esperado no <strong>Servlet</strong>.</li>
<li>Preencher a lista de cidades associadas ao estado.</li>
</ol><p>Para realizar isso, basta fazermos o seguinte:  </p>

<pre><code>      $.ajax({
        type: "GET",
        url: "BuscaCidade",
        dataType: "html",
        data: {uf: $('#estado').val() }
      }).done(function(data){
        $('#cidade').html(data);
      });
</code></pre>

<p>Explicando cada chave do <em>ajax</em>.<br><code>type</code> é o método que será usado para o envio das informações para o servidor;<br><code>url</code> é o caminho para o <strong>Servlet</strong> que irá responder a requisição;<br><code>dataType</code> é o tipo de dado que o <strong>Servlet</strong> irá retornar;<br><code>data</code> é um <strong>json</strong> com as chaves e valores que serão enviados para o servlet processar.<br>
O método <code>.done</code> é o que irá preencher a lista de cidades com o valor retornado pela requisição <strong>Ajax</strong>, sendo que <strong>data</strong> é o que o servidor retornou.  </p>
        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/hugonomura" class="avatar"><img src="https://secure.gravatar.com/avatar/aba3372625d61846c87c2f8b6cd50659?s=30&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" width="48" height="48"/></a> <a href="https://github.com/hugonomura">hugonomura</a> maintains <a href="https://github.com/hugonomura/caronas-servlet">Tutorial Ajax + Servlet Java</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br/>theme by <a href="http://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/hugonomura/caronas-servlet/tarball/master" class="tar">tar</a><a href="https://github.com/hugonomura/caronas-servlet/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

  
</body>
</html>
