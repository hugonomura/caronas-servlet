{"name":"Tutorial JSP","tagline":"","body":"# Caronas\r\n--\r\nContinuando nosso projeto de caronas, agora iremos usar **JSP**.  \r\nIremos mexer no método **doPost** do *controller* `EfetuaLogin`, e caso o usuário seja `adm`, irão ser abertas novas opções no menu.  \r\n  \r\n# doPost\r\n--\r\nDentro do método **doPost**, remova as linhas de código que estiverem nela, deixando apenas a declaração do método.  \r\n[<img src=\"https://raw.github.com/hugonomura/imagens-tutorial/master/img20.png\">](#)  \r\n  \r\nVamos fazer a recuperação dos dados do formulário normalmente no **servlet**, da seguinte forma:  \r\n  \r\n      String login = request.getParameter(\"login\");\r\n      String senha = request.getParameter(\"senha\");\r\n  \r\nPodemos fazer também algum tipo de validação de **login** e **senha**, como ainda não temos acesso ao banco de dados, podemos verificar simplesmente se **login** e **senha** tem o mesmo valor, da seguinte forma:  \r\n  \r\n      if(login.equals(senha)){\r\n         // aqui faremos o redirecionamento para a página 'logado'\r\n      }else{\r\n         // aqui faremos o redirecionamento para a página de login\r\n      }\r\n  \r\nAgora, por uma questão de comodidade, faremos o redirecionamento de volta para a página de **login**, caso os campos `login` e `senha` não possuam o mesmo valor. Para isso, usaremos o método `sendRedirect`, que pertence ao objeto **response**.  \r\nPara isso, basta fazermos isso:  \r\n  \r\n      response.sendRedirect(\"/index.html\");\r\n  \r\nCom isso feito, voltemos para o nosso `if(login.equals(senha))` para realizar o redirecionamento para a página logado.  \r\nPara fazermos isso, precisamos do método `foward` pertencente a classe **RequestDispatcher**. Basta criarmos uma instância da classe **RequestDispatcher**, da seguinte forma:  \r\n  \r\n      RequestDispatcher rd = null;\r\n  \r\nProvavelmente, o **Netbeans** está indicando um erro nessa linha, pois não realizamos o import dessa classe. Resolvemos isso criando o import para **javax.servlet.RequestDispatcher** (basta adicionar `import javax.servlet.RequestDispatcher;` junto aos imports no inicio da classe)...  \r\nou podemos simplesmente clicar sobre o ícone apontando o erro na linha...  \r\n[<img src=\"https://raw.github.com/hugonomura/imagens-tutorial/master/img21.png\">](#)  \r\n  \r\n e pedir para a **IDE** realizar o import.  \r\n[<img src=\"https://raw.github.com/hugonomura/imagens-tutorial/master/img22.png\">](#)  \r\n  \r\nPodemos adicionar um novo atributo ao objeto `request`, que chamaremos de **admin** que caso ela seja **true**, significa que o **usuário** é um **admin** e, caso contrário, o **usuário** é um usuário comum do sistema, para isso basta fazermos isso:  \r\n  \r\n        request.setAttribute(\"admin\", true);\r\n  \r\nFeito isso, já temos tudo que precisamos para fazermos o devido tratamento na **view**, nos restando apenas redirecionar a requisição para a **view** apropriada. Para isso basta usarmos o **RequestDispatcher**, da seguinte forma:  \r\n  \r\n         rd = request.getRequestDispatcher(\"/viewLogado.jsp\");\r\n         rd.forward(request, response);\r\n  \r\nAssim, a nossa página `viewLogado` irá tratar a requisição.  \r\n  \r\n# Criando a view...\r\n--\r\nPara criar uma nova página **JSP**, basta clicarmos com o **botão direito** em `Páginas Web` > `Novo` > `JSP...`  \r\n  \r\nMudar o nome do arquivo para viewLogado...\r\n[<img src=\"https://raw.github.com/hugonomura/imagens-tutorial/master/img23.png\">](#)  \r\n  \r\nE clicar em `Finalizar`.  \r\n  \r\n# Editando a view...\r\n--\r\nAgora que já temos a **view** criada, podemos editá-la de acordo com o que realmente queremos fazer.  \r\nPodemos apagar todo o conteúdo do arquivo gerado e substituir pelo conteúdo do nosso `index.html`, apenas para termos um ponto de partida.  \r\nComo queremos editar o menu superior, devemos encontrar as linhas do menu e alterá-las para aparecer diferentes opções caso o usuário seja do tipo **admin**, conforme o **atributo** que registramos no nosso **servlet**.  \r\n[<img src=\"https://raw.github.com/hugonomura/imagens-tutorial/master/img24.png\">](#)  \r\n  \r\n[<img src=\"https://raw.github.com/hugonomura/imagens-tutorial/master/img25.png\">](#)  \r\n  \r\n# Resultado\r\n--\r\nAo fim desse tutorial, o método `doPost` do **servlet** `EfetuaLogin`, deve estar assim:  \r\n  \r\n        @Override\r\n        protected void doPost(HttpServletRequest request, HttpServletResponse response)\r\n                throws ServletException, IOException {\r\n            String login = request.getParameter(\"login\");\r\n            String senha = request.getParameter(\"senha\");\r\n\r\n            if(login.equals(senha)){\r\n                  if(login.equals(\"adm\")){\r\n                      RequestDispatcher rd = null;\r\n                      request.setAttribute(\"admin\", true);\r\n                      rd = request.getRequestDispatcher(\"/viewLogado.jsp\");\r\n                      rd.forward(request, response);\r\n                  }\r\n            }else{\r\n                response.sendRedirect(\"/index.html\");\r\n            }\r\n\r\n        }\r\n  \r\n  \r\nE a página `viewLogado`, deve estar assim:  \r\n  \r\n        <!DOCTYPE html>\r\n        <html>\r\n          <head>\r\n            <title>Caronas | Inicio</title>\r\n            <meta charset=\"UTF-8\">\r\n            <link rel=\"stylesheet\" type=\"text/css\" href=\"estilo.css\">\r\n            <script src=\"http://code.jquery.com/jquery-1.9.1.js\"></script>\r\n          </head>\r\n          <body>\r\n            <header class=\"container\">\r\n              <h1 id=\"logo\"><a href=\"index.html\">Caronas</a></h1>\r\n              <nav id=\"menu\">\r\n                <ul>\r\n                    <% \r\n                        if(request.getParameter(\"admin\")){\r\n                      %>\r\n                    <li><a href=\"#.html\" class=\"active\">Autorização de usuário</a></li>\r\n                    <li><a href=\"#.html\">Cadastro de Rotas</a></li>\r\n                    <%\r\n                        }\r\n                      %>\r\n                </ul>\r\n              </nav>\r\n            </header>\r\n            <section class=\"container\">\r\n              <article id=\"form\">\r\n                <header>\r\n                  <h1>Login</h1>\r\n                </header>\r\n                <form method=\"post\" action=\"EfetuaLogin\">\r\n                  <p><label for=\"login\">Login</label><input type=\"text\" id=\"login\" name=\"login\"></p>\r\n                  <p><label for=\"senha\">Senha</label><input type=\"password\" id=\"senha\" name=\"senha\"></p>\r\n                  <p><input type=\"submit\" value=\"Logar!\"></p>\r\n                </form>\r\n              </article>\r\n            </section>\r\n            <footer class=\"container\">\r\n              <p>Desenvolvimento Web - UFSCar Sorocaba - 2013</p>\r\n            </footer>\r\n            <script>\r\n              $(document).ready(function(){\r\n\r\n              });\r\n            </script>\r\n          </body>\r\n        </html>\r\n    ","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}